#include <stdint.h>
#include <unistd.h>
#include "model.h"

// Modifier Keys
static struct options modifier_key_value[] = {
	{.opt = "left_ctrl", .val = 0x01},
	{.opt = "right_ctrl", .val = 0x10},
	{.opt = "left_shift", .val = 0x02},
	{.opt = "right_shift", .val = 0x20},
	{.opt = "left_alt", .val = 0x04},
	{.opt = "right_alt", .val = 0x40},
	{.opt = "left_meta", .val = 0x08},
	{.opt = "right_meta", .val = 0x80},
	{.opt = NULL}
};

// Keyboard mapping
// Refer: https://www.usb.org/sites/default/files/hut1_3_0.pdf
static struct options key_value[] = {
	{.opt = "key_reserved_00", .val = 0x00},
	{.opt = "key_error_roll_over", .val = 0x01},
	{.opt = "key_post_fail", .val = 0x02},
	{.opt = "key_error_undefined", .val = 0x03},
	{.opt = "key_a", .val = 0x04},
	{.opt = "key_b", .val = 0x05},
	{.opt = "key_c", .val = 0x06},
	{.opt = "key_d", .val = 0x07},
	{.opt = "key_e", .val = 0x08},
	{.opt = "key_f", .val = 0x09},
	{.opt = "key_g", .val = 0x0a},
	{.opt = "key_h", .val = 0x0b},
	{.opt = "key_i", .val = 0x0c},
	{.opt = "key_j", .val = 0x0d},
	{.opt = "key_k", .val = 0x0e},
	{.opt = "key_l", .val = 0x0f},
	{.opt = "key_m", .val = 0x10},
	{.opt = "key_n", .val = 0x11},
	{.opt = "key_o", .val = 0x12},
	{.opt = "key_p", .val = 0x13},
	{.opt = "key_q", .val = 0x14},
	{.opt = "key_r", .val = 0x15},
	{.opt = "key_s", .val = 0x16},
	{.opt = "key_t", .val = 0x17},
	{.opt = "key_u", .val = 0x18},
	{.opt = "key_v", .val = 0x19},
	{.opt = "key_w", .val = 0x1a},
	{.opt = "key_x", .val = 0x1b},
	{.opt = "key_y", .val = 0x1c},
	{.opt = "key_z", .val = 0x1d},
	{.opt = "key_1", .val = 0x1e},
	{.opt = "key_2", .val = 0x1f},
	{.opt = "key_3", .val = 0x20},
	{.opt = "key_4", .val = 0x21},
	{.opt = "key_5", .val = 0x22},
	{.opt = "key_6", .val = 0x23},
	{.opt = "key_7", .val = 0x24},
	{.opt = "key_8", .val = 0x25},
	{.opt = "key_9", .val = 0x26},
	{.opt = "key_0", .val = 0x27},
	{.opt = "key_enter", .val = 0x28},
	{.opt = "key_escape", .val = 0x29},
	{.opt = "key_backspace", .val = 0x2a},
	{.opt = "key_tab", .val = 0x2b},
	{.opt = "key_spacebar", .val = 0x2c},
	{.opt = "key_minus", .val = 0x2d},
	{.opt = "key_equal", .val = 0x2e},
	{.opt = "key_open_square_bracket", .val = 0x2f},
	{.opt = "key_close_square_bracket", .val = 0x30},
	{.opt = "key_backslash", .val = 0x31},
	{.opt = "key_nonus_tilde", .val = 0x32},
	{.opt = "key_semicolon", .val = 0x33},
	{.opt = "key_apostrophe", .val = 0x34},
	{.opt = "key_grave", .val = 0x35},
	{.opt = "key_comma", .val = 0x36},
	{.opt = "key_period", .val = 0x37},
	{.opt = "key_fowardslash", .val = 0x38},
	{.opt = "key_capslock", .val = 0x39},
	{.opt = "key_f1", .val = 0x3a},
	{.opt = "key_f2", .val = 0x3b},
	{.opt = "key_f3", .val = 0x3c},
	{.opt = "key_f4", .val = 0x3d},
	{.opt = "key_f5", .val = 0x3e},
	{.opt = "key_f6", .val = 0x3f},
	{.opt = "key_f7", .val = 0x40},
	{.opt = "key_f8", .val = 0x41},
	{.opt = "key_f9", .val = 0x42},
	{.opt = "key_f10", .val = 0x43},
	{.opt = "key_f11", .val = 0x44},
	{.opt = "key_f12", .val = 0x45},
	{.opt = "key_printscreen", .val = 0x46},
	{.opt = "key_scroollock", .val = 0x47},
	{.opt = "key_pause", .val = 0x48},
	{.opt = "key_insert", .val = 0x49},
	{.opt = "key_home", .val = 0x4a},
	{.opt = "key_page_up", .val = 0x4b},
	{.opt = "key_delete", .val = 0x4c},
	{.opt = "key_end", .val = 0x4d},
	{.opt = "key_page_down", .val = 0x4e},
	{.opt = "key_right_arrow", .val = 0x4f},
	{.opt = "key_left_arrow", .val = 0x50},
	{.opt = "key_down_arrow", .val = 0x51},
	{.opt = "key_up_arrow", .val = 0x52},
	{.opt = "key_numlock", .val = 0x53},
	{.opt = "key_pad_forward_slash", .val = 0x54},
	{.opt = "key_pad_asterisk", .val = 0x55},
	{.opt = "key_pad_minus", .val = 0x56},
	{.opt = "key_pad_plus", .val = 0x57},
	{.opt = "key_pad_enter", .val = 0x58},
	{.opt = "key_pad_1", .val = 0x59},
	{.opt = "key_pad_2", .val = 0x5a},
	{.opt = "key_pad_3", .val = 0x5b},
	{.opt = "key_pad_4", .val = 0x5c},
	{.opt = "key_pad_5", .val = 0x5d},
	{.opt = "key_pad_6", .val = 0x5e},
	{.opt = "key_pad_7", .val = 0x5f},
	{.opt = "key_pad_8", .val = 0x60},
	{.opt = "key_pad_9", .val = 0x61},
	{.opt = "key_pad_0", .val = 0x62},
	{.opt = "key_pad_period", .val = 0x63},
	{.opt = "key_nonus_backslash", .val = 0x64},
	{.opt = "key_application", .val = 0x65},
	{.opt = "key_power", .val = 0x66},
	{.opt = "key_pad_equal", .val = 0x67},
	{.opt = "key_f13", .val = 0x68},
	{.opt = "key_f14", .val = 0x69},
	{.opt = "key_f15", .val = 0x6a},
	{.opt = "key_f16", .val = 0x6b},
	{.opt = "key_f17", .val = 0x6c},
	{.opt = "key_f18", .val = 0x6d},
	{.opt = "key_f19", .val = 0x6e},
	{.opt = "key_f20", .val = 0x6f},
	{.opt = "key_f21", .val = 0x70},
	{.opt = "key_f22", .val = 0x71},
	{.opt = "key_f23", .val = 0x72},
	{.opt = "key_f24", .val = 0x73},
	{.opt = "key_execute", .val = 0x74},
	{.opt = "key_help", .val = 0x75},
	{.opt = "key_menu", .val = 0x76},
	{.opt = "key_select", .val = 0x77},
	{.opt = "key_stop", .val = 0x78},
	{.opt = "key_again", .val = 0x79},
	{.opt = "key_undo", .val = 0x7a},
	{.opt = "key_cut", .val = 0x7b},
	{.opt = "key_copy", .val = 0x7c},
	{.opt = "key_paste", .val = 0x7d},
	{.opt = "key_find", .val = 0x7e},
	{.opt = "key_mute", .val = 0x7f},
	{.opt = "key_vol_up", .val = 0x80},
	{.opt = "key_vol_down", .val = 0x81},
	{.opt = "key_locking_capslock", .val = 0x82},
	{.opt = "key_locking_numlock", .val = 0x83},
	{.opt = "key_locking_scrolllock", .val = 0x84},
	{.opt = "key_pad_comma", .val = 0x85},
	{.opt = "key_pad_equal_2", .val = 0x86},
	{.opt = "key_internation_1", .val = 0x87},
	{.opt = "key_internation_2", .val = 0x88},
	{.opt = "key_internation_3", .val = 0x89},
	{.opt = "key_internation_4", .val = 0x8a},
	{.opt = "key_internation_5", .val = 0x8b},
	{.opt = "key_internation_6", .val = 0x8c},
	{.opt = "key_internation_7", .val = 0x8d},
	{.opt = "key_internation_8", .val = 0x8e},
	{.opt = "key_internation_9", .val = 0x8f},
	{.opt = "key_lang_1", .val = 0x90},
	{.opt = "key_lang_2", .val = 0x91},
	{.opt = "key_lang_3", .val = 0x92},
	{.opt = "key_lang_4", .val = 0x93},
	{.opt = "key_lang_5", .val = 0x94},
	{.opt = "key_lang_6", .val = 0x95},
	{.opt = "key_lang_7", .val = 0x96},
	{.opt = "key_lang_8", .val = 0x97},
	{.opt = "key_lang_9", .val = 0x98},
	{.opt = "key_alternate_erase", .val = 0x99},
	{.opt = "key_sysrq", .val = 0x9a},
	{.opt = "key_cancel", .val = 0x9b},
	{.opt = "key_clear", .val = 0x9c},
	{.opt = "key_prior", .val = 0x9d},
	{.opt = "key_return", .val = 0x9e},
	{.opt = "key_seperator", .val = 0x9f},
	{.opt = "key_out", .val = 0xa0},
	{.opt = "key_oper", .val = 0xa1},
	{.opt = "key_clear_again", .val = 0xa2},
	{.opt = "key_crsel", .val = 0xa3},
	{.opt = "key_excel", .val = 0xa4},
	{.opt = "key_reserved_a5", .val = 0xa5},
	{.opt = "key_reserved_a6", .val = 0xa6},
	{.opt = "key_reserved_a7", .val = 0xa7},
	{.opt = "key_reserved_a8", .val = 0xa8},
	{.opt = "key_reserved_a9", .val = 0xa9},
	{.opt = "key_reserved_aa", .val = 0xaa},
	{.opt = "key_reserved_ab", .val = 0xab},
	{.opt = "key_reserved_ac", .val = 0xac},
	{.opt = "key_reserved_ad", .val = 0xad},
	{.opt = "key_reserved_ae", .val = 0xae},
	{.opt = "key_reserved_af", .val = 0xaf},
	{.opt = "key_pad_00", .val = 0xb0},
	{.opt = "key_pad_000", .val = 0xb1},
	{.opt = "key_thousand_separator", .val = 0xb2},
	{.opt = "key_decimal_separator", .val = 0xb3},
	{.opt = "key_currency_unit", .val = 0xb4},
	{.opt = "key_currency_sub_unit", .val = 0xb5},
	{.opt = "key_pad_open_bracket", .val = 0xb6},
	{.opt = "key_pad_close_bracket", .val = 0xb7},
	{.opt = "key_pad_open_curly_bracket", .val = 0xb8},
	{.opt = "key_pad_close_curly_bracket", .val = 0xb9},
	{.opt = "key_pad_tab", .val = 0xba},
	{.opt = "key_pad_backspace", .val = 0xbb},
	{.opt = "key_pad_a", .val = 0xbc},
	{.opt = "key_pad_b", .val = 0xbd},
	{.opt = "key_pad_c", .val = 0xbe},
	{.opt = "key_pad_d", .val = 0xbf},
	{.opt = "key_pad_e", .val = 0xc0},
	{.opt = "key_pad_f", .val = 0xc1},
	{.opt = "key_pad_xor", .val = 0xc2},
	{.opt = "key_pad_caret", .val = 0xc3},
	{.opt = "key_pad_percentage", .val = 0xc4},
	{.opt = "key_pad_open_angle_bracket", .val = 0xc5},
	{.opt = "key_pad_close_angle_bracket", .val = 0xc6},
	{.opt = "key_pad_ampersand", .val = 0xc7},
	{.opt = "key_pad_double_ampersand", .val = 0xc8},
	{.opt = "key_pad_vertical_bar", .val = 0xc9},
	{.opt = "key_pad_double_vertical_bar", .val = 0xca},
	{.opt = "key_pad_colon", .val = 0xcb},
	{.opt = "key_pad_hash", .val = 0xcc},
	{.opt = "key_pad_space", .val = 0xcd},
	{.opt = "key_pad_at", .val = 0xce},
	{.opt = "key_pad_exclamation", .val = 0xcf},
	{.opt = "key_pad_memory_store", .val = 0xd0},
	{.opt = "key_pad_memory_recall", .val = 0xd1},
	{.opt = "key_pad_memory_clear", .val = 0xd2},
	{.opt = "key_pad_memory_add", .val = 0xd3},
	{.opt = "key_pad_memory_subtract", .val = 0xd4},
	{.opt = "key_pad_memory_multiply", .val = 0xd5},
	{.opt = "key_pad_memory_divide", .val = 0xd6},
	{.opt = "key_pad_plus_minus", .val = 0xd7},
	{.opt = "key_pad_clear", .val = 0xd8},
	{.opt = "key_pad_clear_enter", .val = 0xd9},
	{.opt = "key_pad_binary", .val = 0xda},
	{.opt = "key_pad_octal", .val = 0xdb},
	{.opt = "key_pad_decimal", .val = 0xdc},
	{.opt = "key_pad_hexadecimal", .val = 0xdd},
	{.opt = "key_reserved_de", .val = 0xde},
	{.opt = "key_reserved_df", .val = 0xdf},
	{.opt = "key_left_ctrl", .val = 0xe0},
	{.opt = "key_left_shift", .val = 0xe1},
	{.opt = "key_left_alt", .val = 0xe2},
	{.opt = "key_left_gui", .val = 0xe3},
	{.opt = "key_right_ctrl", .val = 0xe4},
	{.opt = "key_right_shift", .val = 0xe5},
	{.opt = "key_right_alt", .val = 0xe6},
	{.opt = "key_right_gui", .val = 0xe7},
	{.opt = NULL}
};

struct __attribute__((__packed__))
{
	uint8_t modifier_key;
	uint8_t reserved;
	uint8_t keys[6];
} keyboard_packet;